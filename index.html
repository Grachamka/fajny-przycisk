<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fajny Przycisk ‚Äî FIXED</title>
<style>
  :root{
    --bg1:#0a0f2c; --bg2:#000814; --accent:#ff3b3b;
  }
  html,body{height:100%;margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:radial-gradient(circle at center,var(--bg1),var(--bg2));color:#fff;overflow:hidden}
  /* canvas (stars) */
  #starCanvas{position:fixed;inset:0;z-index:0;display:none}
  /* gold overlay class */
  body.goldBG{background: linear-gradient(90deg,#fff0a8,#ffd24a,#fff1b8,#ffb84d) !important;color:black !important}

  .app{position:relative;z-index:5;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:12px;box-sizing:border-box;gap:12px}
  header{width:100%;display:flex;align-items:center;justify-content:center;position:relative}
  h1{margin:0;font-size:clamp(18px,4.6vw,28px);letter-spacing:2px}
  #points{position:absolute;left:12px;top:8px;font-size:14px}
  #shopIcon{position:absolute;right:10px;top:8px;background:rgba(255,255,255,0.06);border-radius:12px;padding:8px;cursor:pointer;z-index:6}

  /* BIG centered button */
  #mainButton{
    width: min(92%, 820px);
    max-width:820px;
    height: min(18vh,160px);
    min-height:78px;
    display:flex;align-items:center;justify-content:center;
    font-size: clamp(30px, 8vw, 64px);
    border-radius:30px;border:none;background:var(--accent);color:#fff;
    box-shadow:0 18px 40px rgba(0,0,0,.45);
    cursor:pointer; user-select:none; -webkit-tap-highlight-color: transparent;
    transition: transform .08s ease, box-shadow .12s ease;
  }
  #mainButton:active{ transform:scale(.98); box-shadow:0 10px 24px rgba(0,0,0,.35) }

  #eventText{font-size:clamp(14px,3.2vw,18px);min-height:28px;text-align:center;opacity:.95;z-index:6}

  /* fullscreen image over everything */
  #fullscreenImage{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;display:none;z-index:45}

  /* legendary banner */
  #legendaryBanner{position:fixed;left:0;right:0;top:28%;display:none;z-index:60;font-size:clamp(28px,10vw,80px);text-align:center;color:gold;text-shadow:0 0 30px rgba(255,200,0,.95)}

  /* shop overlay */
  .shopOverlay{position:fixed;inset:0;background:rgba(0,0,0,0.92);backdrop-filter: blur(6px);z-index:50;display:none;align-items:flex-start;justify-content:center;padding:20px;overflow:auto}
  .shopCard{width:min(1000px,96%);background:rgba(255,255,255,0.02);border-radius:14px;padding:14px;margin:10px auto;color:#fff;box-shadow:0 16px 40px rgba(0,0,0,.6)}
  .shopGrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-top:12px}
  .item{padding:12px;border-radius:12px;background:rgba(255,255,255,0.02);display:flex;flex-direction:column;gap:8px}
  .item button{padding:8px;border-radius:10px;border:none;background:#1f6feb;color:white;cursor:pointer}

  /* loot animation */
  #lootArea{margin-top:12px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);min-height:120px;display:none;align-items:center;justify-content:center;position:relative;overflow:hidden}
  .lootRow{display:flex;gap:10px;transition:transform 2.4s cubic-bezier(.2,.9,.2,1)}
  .lootCard{min-width:160px;height:100px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff;font-size:18px}
  .common{background:#6b7280} .rare{background:#2563eb} .epic{background:#7c3aed} .legendary{background:linear-gradient(45deg,#f6d365,#fda085);color:black}

  @media(min-width:900px){ #mainButton{height:120px} }
</style>
</head>
<body class="bg-default">
  <canvas id="starCanvas"></canvas>

  <div class="app">
    <header>
      <div id="points">Punkty: 0</div>
      <div id="shopIcon" title="Sklep" onclick="openShop()">üõí</div>
      <h1>FAJNY PRZYCISK</h1>
    </header>

    <button id="mainButton">?</button>
    <div id="eventText" class="small"></div>
  </div>

  <img id="fullscreenImage" alt="event image">
  <div id="legendaryBanner">LEGENDARNY!</div>

  <!-- SHOP OVERLAY -->
  <div class="shopOverlay" id="shopOverlay" aria-hidden="true">
    <div class="shopCard" role="dialog" aria-modal="true">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <h2>SKLEP</h2>
        <button onclick="closeShop()">‚ùå</button>
      </div>

      <p style="margin:6px 0;color:#ddd">Masz <strong id="shopPoints">0</strong> pkt</p>

      <div class="shopGrid">
        <div class="item">
          <h3>üéÅ Lucky Skrzynka</h3>
          <p class="small">Koszt: <strong>50 pkt</strong></p>
          <button onclick="buyAndOpenBox()">Kup i Otw√≥rz (50)</button>
        </div>

        <div class="item">
          <h3>‚ú® Z≈Çoty Skin</h3>
          <p class="small">Koszt: <strong>150 pkt</strong></p>
          <button onclick="buySkin('legendary',150)">Kup Z≈Çoty</button>
        </div>

        <div class="item">
          <h3>üåà RGB Skin</h3>
          <p class="small">Koszt: <strong>350 pkt</strong></p>
          <button onclick="buySkin('rgb',350)">Kup RGB</button>
        </div>

        <div class="item">
          <h3>üåå T≈Ço Kosmos</h3>
          <p class="small">Koszt: <strong>250 pkt</strong></p>
          <button onclick="buyBackground('space',250)">Kup T≈Ço</button>
        </div>

        <div class="item">
          <h3>üéµ Muzyka (legendarny)</h3>
          <p class="small">Koszt: <strong>200 pkt</strong></p>
          <button onclick="buyMusic(200)">Kup Music</button>
        </div>

        <div class="item">
          <h3>üéí Ekwipunek</h3>
          <p class="small">Kliknij skin, ≈ºeby go wyposa≈ºyƒá:</p>
          <div id="inventoryList" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px"></div>
        </div>
      </div>

      <div id="lootArea" style="margin-top:12px;display:none">
        <div id="lootRow" class="lootRow"></div>
      </div>

      <p class="small" style="margin-top:12px">Procenty: <strong>Common 60% / Rare 25% / Epic 10% / Legendary 5%</strong></p>
    </div>
  </div>

<script>
/* ---------- resources ---------- */
const PICS = [
  "https://picsum.photos/1200/2000?random=11",
  "https://picsum.photos/1200/2000?random=22",
  "https://images.unsplash.com/photo-1503023345310-bd7c1de61c7d?w=1300&q=80",
  "https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1300&q=80",
  "https://picsum.photos/1200/2000?random=55",
  "https://picsum.photos/1200/2000?random=66",
  "https://picsum.photos/1200/2000?random=77",
  "https://picsum.photos/1200/2000?random=88"
];

const SOUNDS = {
  click: "https://www.soundjay.com/buttons/sounds/button-16.mp3",
  rare:  "https://www.soundjay.com/buttons/sounds/button-3.mp3",
  epic:  "https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3",
  legendary: "https://www.soundjay.com/human/sounds/applause-8.mp3",
  box: "https://www.soundjay.com/misc/sounds/box-opening-1.mp3"
};

const RATES = [
  { id:"common", pct:60, pts:1, sound:null },
  { id:"rare",   pct:25, pts:5, sound:SOUNDS.rare },
  { id:"epic",   pct:10, pts:20, sound:SOUNDS.epic },
  { id:"legendary", pct:5, pts:100, sound:SOUNDS.legendary }
];

/* ---------- state ---------- */
let state = {
  points: parseInt(localStorage.getItem("points")||"0"),
  ownedSkins: JSON.parse(localStorage.getItem("ownedSkins")||'["red"]'),
  activeSkin: localStorage.getItem("activeSkin") || "red",
  ownedBackgrounds: JSON.parse(localStorage.getItem("ownedBackgrounds")||'[]'),
  activeBackground: localStorage.getItem("activeBackground") || "default",
  legendaryActive: (localStorage.getItem("legendaryActive")==="true"),
  musicBought: (localStorage.getItem("musicBought")==="true"),
  canClick: true
};

/* ---------- audio preloads (created but played on user gesture) ---------- */
const audioClick = new Audio(SOUNDS.click);
const audioRare  = new Audio(SOUNDS.rare);
const audioEpic  = new Audio(SOUNDS.epic);
const audioLegend= new Audio(SOUNDS.legendary);
const audioBox   = new Audio(SOUNDS.box);
// set preload
[audioClick,audioRare,audioEpic,audioLegend,audioBox].forEach(a=>{ a.preload="auto"; try{ a.load(); }catch(e){} });

/* ---------- starfield (canvas) ---------- */
const canvas = document.getElementById("starCanvas");
let stars = [], starAnim = null;
function startStars(){
  canvas.style.display = "block";
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  const ctx = canvas.getContext("2d");
  stars = [];
  const count = Math.round((canvas.width * canvas.height) / 40000); // scalable
  for(let i=0;i<count;i++){
    stars.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, z: Math.random()*1, s: Math.random()*1.2+0.2 });
  }
  let t = 0;
  cancelAnimationFrame(starAnim);
  function loop(){
    t += 0.01;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(const s of stars){
      s.x += Math.cos(t + s.z)*0.2;
      s.y += Math.sin(t + s.z)*0.2;
      // wrap
      if(s.x < 0) s.x = canvas.width;
      if(s.x > canvas.width) s.x = 0;
      if(s.y < 0) s.y = canvas.height;
      if(s.y > canvas.height) s.y = 0;
      const alpha = 0.6 + 0.4*Math.sin((s.x+s.y+t*10)/100);
      ctx.fillStyle = "rgba(255,255,255,"+alpha+")";
      ctx.beginPath();
      ctx.arc(s.x,s.y, s.s, 0, Math.PI*2);
      ctx.fill();
    }
    starAnim = requestAnimationFrame(loop);
  }
  loop();
}
function stopStars(){
  canvas.style.display = "none";
  cancelAnimationFrame(starAnim);
}

/* ---------- helpers ---------- */
function saveState(){ localStorage.setItem("points", String(state.points)); localStorage.setItem("ownedSkins", JSON.stringify(state.ownedSkins)); localStorage.setItem("activeSkin", state.activeSkin); localStorage.setItem("ownedBackgrounds", JSON.stringify(state.ownedBackgrounds)); localStorage.setItem("activeBackground", state.activeBackground); localStorage.setItem("legendaryActive", state.legendaryActive ? "true" : "false"); localStorage.setItem("musicBought", state.musicBought ? "true" : "false"); }

function updateUI(){
  document.getElementById("points").innerText = "Punkty: " + state.points;
  const sp = document.getElementById("shopPoints"); if(sp) sp.innerText = state.points;
  // inventory
  const inv = document.getElementById("inventoryList");
  if(inv){
    inv.innerHTML = "";
    state.ownedSkins.forEach(s=>{
      const b = document.createElement("button");
      b.textContent = s.toUpperCase();
      b.style.padding = "6px 8px";
      b.style.borderRadius = "8px";
      b.style.border = state.activeSkin === s ? "2px solid #fff" : "none";
      b.style.background = colorForSkin(s);
      b.style.color = (s==="legendary") ? "black" : "white";
      b.onclick = ()=>{ state.activeSkin = s; saveState(); applySkin(); updateUI(); closeShop(); };
      inv.appendChild(b);
    });
  }
}

/* ---------- visual apply ---------- */
const mainBtn = document.getElementById("mainButton");
const eventText = document.getElementById("eventText");
const fullImg = document.getElementById("fullscreenImage");
const legendaryBanner = document.getElementById("legendaryBanner");

function applySkin(){
  if(mainBtn._rgbInterval){ clearInterval(mainBtn._rgbInterval); mainBtn._rgbInterval = null; }
  const s = state.activeSkin;
  mainBtn.style.background = ""; mainBtn.style.color = (s==="legendary") ? "black" : "white";
  if(s==="red") mainBtn.style.background = "var(--accent)";
  else if(s==="common") mainBtn.style.background = "#6b7280";
  else if(s==="rare") mainBtn.style.background = "#2563eb";
  else if(s==="epic") mainBtn.style.background = "#7c3aed";
  else if(s==="legendary") mainBtn.style.background = "linear-gradient(45deg,#f6d365,#fda085)";
  else if(s==="rgb"){
    let hue = 0;
    mainBtn._rgbInterval = setInterval(()=> {
      mainBtn.style.background = `linear-gradient(90deg,hsl(${hue},90%,60%),hsl(${(hue+80)%360},90%,60%))`;
      hue = (hue + 6) % 360;
    },80);
  }
}

function applyBackgroundClass(){
  // stop/start stars
  if(state.activeBackground === "space"){ startStars(); } else { stopStars(); }
  // gold overlay
  if(state.legendaryActive){ document.body.classList.add("goldBG"); } else { document.body.classList.remove("goldBG"); }
}

/* ---------- utility ---------- */
function colorForSkin(s){
  if(s==="red") return "red";
  if(s==="common") return "#6b7280";
  if(s==="rare") return "#2563eb";
  if(s==="epic") return "#7c3aed";
  if(s==="legendary") return "linear-gradient(45deg,#f6d365,#fda085)";
  if(s==="rgb") return "#ff7f50";
  return "#333";
}

/* ---------- roll logic ---------- */
function rollRarity(){
  const r = Math.random()*100; let acc = 0;
  for(const item of RATES){ acc += item.pct; if(r <= acc) return item; } return RATES[0];
}

/* ---------- main button ---------- */
mainBtn.addEventListener("click", async ()=>{
  // if gold active -> clicking main button toggles it off (per request)
  if(state.legendaryActive){
    state.legendaryActive = false; saveState(); applyBackgroundClass(); eventText.innerText = "Z≈Çote t≈Ço wy≈ÇƒÖczone."; return;
  }
  if(!state.canClick) return;
  state.canClick = false;

  // play click sound (user gesture allows it)
  try{ await audioClick.play(); }catch(e){ /*ignore*/ }

  const r = rollRarity();
  state.points += r.pts; saveState(); updateUI();

  // full-screen image flash
  fullImg.src = PICS[Math.floor(Math.random()*PICS.length)] + "&t=" + Date.now();
  fullImg.style.display = "block";

  // play rarity sound
  try{ if(r.sound) { const which = (r.id==="rare"?audioRare:(r.id==="epic"?audioEpic:(r.id==="legendary"?audioLegend:null))); if(which) await which.play(); } }catch(e){}

  // visuals
  eventText.style.color = (r.id==="legendary") ? "#ffd700" : (r.id==="epic" ? "#b19aff" : (r.id==="rare" ? "#7ec8ff" : "#ddd"));
  if(r.id==="legendary"){
    eventText.innerText = "üíé LEGENDARNY! +" + r.pts;
    state.legendaryActive = true; saveState(); applyBackgroundClass();
    legendaryBanner.style.display = "block";
    setTimeout(()=>{ legendaryBanner.style.display = "none"; }, 2300);
    if(state.musicBought){ try{ const a = new Audio("https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"); a.volume=0.5; a.play(); }catch(e){} }
  } else {
    eventText.innerText = (r.id==="epic") ? ("EPICKI! +" + r.pts) : ("+" + r.pts);
  }

  // hide image after 1s
  setTimeout(()=>{ fullImg.style.display = "none"; }, 1000);
  // cooldown 1s
  setTimeout(()=>{ state.canClick = true; }, 1000);
});

/* ---------- shop open/close ---------- */
function openShop(){ document.getElementById("shopOverlay").style.display="flex"; updateUI(); applyBackgroundClass(); }
function closeShop(){ document.getElementById("shopOverlay").style.display="none"; applyBackgroundClass(); }

/* ---------- purchases ---------- */
function buySkin(name,cost){
  if(state.points < cost){ alert("Za ma≈Ço punkt√≥w!"); return; }
  state.points -= cost; if(!state.ownedSkins.includes(name)) state.ownedSkins.push(name);
  state.activeSkin = name; saveState(); applySkin(); updateUI(); alert("Kupiono skin: "+name.toUpperCase());
}

function buyBackground(name,cost){
  if(state.points < cost){ alert("Za ma≈Ço punkt√≥w!"); return; }
  state.points -= cost; if(!state.ownedBackgrounds.includes(name)) state.ownedBackgrounds.push(name);
  state.activeBackground = name; saveState(); applyBackgroundClass(); updateUI(); alert("Kupiono t≈Ço: "+name);
}

function buyMusic(cost){
  if(state.points < cost){ alert("Za ma≈Ço punkt√≥w!"); return; }
  state.points -= cost; state.musicBought = true; saveState(); updateUI(); alert("Kupiono muzykƒô legendarnƒÖ.");
}

/* ---------- lucky box ---------- */
function buyAndOpenBox(){
  if(state.points < 50){ alert("Za ma≈Ço punkt√≥w!"); return; }
  state.points -= 50; saveState(); updateUI();
  try{ audioBox.play().catch(()=>{}); }catch(e){}
  const lootArea = document.getElementById("lootArea"); const lootRow = document.getElementById("lootRow");
  lootArea.style.display = "flex"; lootRow.innerHTML = "";
  const seq = []; const len = 18;
  for(let i=0;i<len;i++){
    const rr = Math.random()*100; let id="common";
    if(rr < 60) id="common"; else if(rr < 85) id="rare"; else if(rr < 95) id="epic"; else id="legendary";
    seq.push(id);
  }
  seq.forEach(s=>{
    const d = document.createElement("div"); d.className = "lootCard " + s; d.textContent = s.toUpperCase(); lootRow.appendChild(d);
  });
  // animate: center on index 7
  setTimeout(()=>{ const itemW = (lootRow.children[0].offsetWidth + 10); const offset = itemW * 7; lootRow.style.transform = "translateX(-" + offset + "px)"; }, 80);
  setTimeout(()=>{
    const won = seq[7]; const rate = RATES.find(r=>r.id===won);
    if(rate){ state.points += rate.pts; if(!state.ownedSkins.includes(won)) state.ownedSkins.push(won); state.activeSkin = won;
      if(won === "legendary"){ state.legendaryActive = true; legendaryBanner.style.display = "block"; setTimeout(()=>{ legendaryBanner.style.display = "none"; },2300); if(state.musicBought){ try{ const a = new Audio("https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"); a.volume=0.5; a.play(); }catch(e){} } }
      saveState(); applySkin(); applyBackgroundClass(); updateUI(); alert("Skrzynka da≈Ça: " + won.toUpperCase() + " (+" + rate.pts + " pkt). Skin ustawiony."); }
    lootArea.style.display = "none"; lootRow.style.transform = "translateX(0)";
  },2600);
}

/* ---------- init ---------- */
applySkin(); applyBackgroundClass(); updateUI();

/* handle resize for stars canvas */
window.addEventListener("resize", ()=>{ if(state.activeBackground==="space") startStars(); });
</script>
</body>
</html>
