<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Fajny Przycisk ‚Äî PRO FIX</title>
<style>
  :root{
    --bg1:#0a0f2c; --bg2:#000814; --accent:#ff3b3b;
  }
  html,body{height:100%;margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:var(--bg-gradient);color:#fff}
  /* background variants using classes (no inline style) */
  body.bg-default{ background: radial-gradient(circle at center,var(--bg1),var(--bg2)); }
  body.bg-space{ background: url('https://i.imgur.com/9aKQZ8L.jpg') center/cover fixed no-repeat; }
  /* gold must override others */
  body.goldBG{
    background: linear-gradient(90deg,#fff0a8,#ffd24a,#fff1b8,#ffb84d) !important;
    color: black !important;
    transition: background 0.6s ease;
  }

  .app{display:flex;flex-direction:column;align-items:center;height:100%;padding:12px;box-sizing:border-box}
  header{width:100%;display:flex;align-items:center;justify-content:center;position:relative;margin-top:6px}
  h1{margin:0;font-size:clamp(18px,4.6vw,32px);letter-spacing:2px}
  #points{position:absolute;left:12px;top:6px;font-size:14px}
  #shopIcon{position:absolute;right:10px;top:6px;background:rgba(255,255,255,0.06);border-radius:12px;padding:8px;cursor:pointer}

  /* BIG RESPONSIVE BUTTON */
  #mainButton{
    margin-top:22px;
    width:min(94%,760px);
    height:min(16vh,140px);                /* wysoko≈õƒá przycisku na telefonie */
    min-height:72px;
    display:flex;align-items:center;justify-content:center;
    font-size: clamp(28px, 8vw, 56px);
    border-radius:28px;border:none;background:var(--accent);color:#fff;
    box-shadow:0 12px 30px rgba(0,0,0,.45);
    cursor:pointer; user-select:none; -webkit-tap-highlight-color: transparent;
    transition:transform .08s ease, box-shadow .12s ease;
  }
  #mainButton:active{ transform:scale(.98); box-shadow:0 8px 18px rgba(0,0,0,.4); }
  #eventText{margin-top:12px;font-size:clamp(14px,3.2vw,20px);min-height:26px;opacity:.95}

  /* fullscreen image */
  #fullscreenImage{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;display:none;z-index:40}

  /* Legendary banner */
  #legendaryBanner{position:fixed;left:0;right:0;top:28%;display:none;z-index:60;font-size:clamp(28px,10vw,72px);text-align:center;color:gold;text-shadow:0 0 26px rgba(255,200,0,.95)}

  /* SHOP overlay */
  .shopOverlay{position:fixed;inset:0;background:rgba(0,0,0,0.9);backdrop-filter: blur(6px);z-index:50;display:none;align-items:flex-start;justify-content:center;padding:20px;overflow:auto}
  .shopCard{width:min(1000px,96%);background:rgba(255,255,255,0.02);border-radius:14px;padding:14px;margin:10px auto;color:#fff;box-shadow:0 16px 40px rgba(0,0,0,.6)}
  .shopHeader{display:flex;align-items:center;justify-content:space-between}
  .shopGrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-top:12px}
  .item{padding:12px;border-radius:12px;background:rgba(255,255,255,0.02);display:flex;flex-direction:column;gap:8px}
  .item button{padding:8px;border-radius:10px;border:none;background:#1f6feb;color:white;cursor:pointer}

  /* LOOT animation */
  #lootArea{margin-top:12px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);min-height:120px;display:none;align-items:center;justify-content:center;position:relative;overflow:hidden}
  .lootRow{display:flex;gap:10px;transition:transform 2.4s cubic-bezier(.2,.9,.2,1)}
  .lootCard{min-width:160px;height:100px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff;font-size:18px}
  .common{background:#6b7280} .rare{background:#2563eb} .epic{background:#7c3aed} .legendary{background:linear-gradient(45deg,#f6d365,#fda085);color:black}

  /* small helper */
  .small{font-size:13px;opacity:.95}
</style>
</head>
<body class="bg-default">
  <div class="app">
    <header>
      <div id="points">Punkty: 0</div>
      <div id="shopIcon" title="Sklep" onclick="openShop()">üõí</div>
      <h1>FAJNY PRZYCISK</h1>
    </header>

    <button id="mainButton" aria-label="Przycisk g≈Ç√≥wny">?</button>
    <div id="eventText" class="small"></div>
  </div>

  <img id="fullscreenImage" alt="event image">

  <div id="legendaryBanner">LEGENDARNY!</div>

  <!-- SHOP -->
  <div class="shopOverlay" id="shopOverlay" aria-hidden="true">
    <div class="shopCard" role="dialog" aria-modal="true">
      <div class="shopHeader">
        <h2>SKLEP</h2>
        <div>
          <button onclick="closeShop()">‚ùå</button>
        </div>
      </div>

      <p class="small">Masz <strong id="shopPoints">0</strong> pkt</p>

      <div class="shopGrid">
        <div class="item">
          <h3>üéÅ Lucky Skrzynka</h3>
          <p class="small">Koszt: <strong>50 pkt</strong></p>
          <p class="small">Losuje skin + punkty (szansa na LEGENDARNY)</p>
          <button onclick="buyAndOpenBox()">Kup i Otw√≥rz (50)</button>
        </div>

        <div class="item">
          <h3>‚ú® Z≈Çoty Skin</h3>
          <p class="small">Koszt: <strong>150 pkt</strong></p>
          <button onclick="buySkin('legendary',150)">Kup Z≈Çoty</button>
        </div>

        <div class="item">
          <h3>üåà RGB Skin</h3>
          <p class="small">Koszt: <strong>350 pkt</strong></p>
          <button onclick="buySkin('rgb',350)">Kup RGB</button>
        </div>

        <div class="item">
          <h3>üåå T≈Ço Kosmos</h3>
          <p class="small">Koszt: <strong>250 pkt</strong></p>
          <button onclick="buyBackground('space',250)">Kup T≈Ço</button>
        </div>

        <div class="item">
          <h3>üéµ Muzyka (legendarny)</h3>
          <p class="small">Koszt: <strong>200 pkt</strong></p>
          <button onclick="buyMusic(200)">Kup Music</button>
        </div>

        <div class="item">
          <h3>üéí Ekwipunek</h3>
          <p class="small">Kliknij skin, ≈ºeby go wyposa≈ºyƒá:</p>
          <div id="inventoryList" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px"></div>
        </div>
      </div>

      <div id="lootArea">
        <div id="lootRow" class="lootRow"></div>
      </div>

      <p class="small" style="margin-top:12px">Procenty: <strong>Common 60% / Rare 25% / Epic 10% / Legendary 5%</strong></p>
    </div>
  </div>

<script>
/* ---------- resources ---------- */
const PICS = [
  "https://picsum.photos/1200/2000?random=11",
  "https://picsum.photos/1200/2000?random=22",
  "https://images.unsplash.com/photo-1503023345310-bd7c1de61c7d?w=1300&q=80",
  "https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1300&q=80",
  "https://picsum.photos/1200/2000?random=55",
  "https://picsum.photos/1200/2000?random=66",
  "https://picsum.photos/1200/2000?random=77",
  "https://picsum.photos/1200/2000?random=88"
];

const SOUNDS = {
  click: "https://www.soundjay.com/buttons/sounds/button-16.mp3",
  rare:  "https://www.soundjay.com/buttons/sounds/button-3.mp3",
  epic:  "https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3",
  legendary: "https://www.soundjay.com/human/sounds/applause-8.mp3",
  box: "https://www.soundjay.com/misc/sounds/box-opening-1.mp3"
};

const RATES = [
  { id:"common", pct:60, pts:1, sound:null },
  { id:"rare",   pct:25, pts:5, sound:SOUNDS.rare },
  { id:"epic",   pct:10, pts:20, sound:SOUNDS.epic },
  { id:"legendary", pct:5, pts:100, sound:SOUNDS.legendary }
];

/* ---------- state (localStorage) ---------- */
let state = {
  points: parseInt(localStorage.getItem("points")||"0"),
  ownedSkins: JSON.parse(localStorage.getItem("ownedSkins")||'["red"]'),
  activeSkin: localStorage.getItem("activeSkin") || "red",
  ownedBackgrounds: JSON.parse(localStorage.getItem("ownedBackgrounds")||'[]'),
  activeBackground: localStorage.getItem("activeBackground") || "default",
  legendaryActive: (localStorage.getItem("legendaryActive")==="true"),
  musicBought: (localStorage.getItem("musicBought")==="true"),
  canClick: true
};

/* ---------- helpers ---------- */
function saveState(){
  localStorage.setItem("points", String(state.points));
  localStorage.setItem("ownedSkins", JSON.stringify(state.ownedSkins));
  localStorage.setItem("activeSkin", state.activeSkin);
  localStorage.setItem("ownedBackgrounds", JSON.stringify(state.ownedBackgrounds));
  localStorage.setItem("activeBackground", state.activeBackground);
  localStorage.setItem("legendaryActive", state.legendaryActive ? "true" : "false");
  localStorage.setItem("musicBought", state.musicBought ? "true" : "false");
}

function updateUI(){
  document.getElementById("points").innerText = "Punkty: " + state.points;
  document.getElementById("shopPoints").innerText = state.points;
  // inventory
  const inv = document.getElementById("inventoryList");
  inv.innerHTML = "";
  state.ownedSkins.forEach(s=>{
    const b = document.createElement("button");
    b.textContent = s.toUpperCase();
    b.style.padding = "6px 8px";
    b.style.borderRadius = "8px";
    b.style.border = state.activeSkin === s ? "2px solid #fff" : "none";
    b.style.background = colorForSkin(s);
    b.style.color = (s==="legendary") ? "black" : "white";
    b.onclick = ()=>{ state.activeSkin = s; saveState(); applySkin(); updateUI(); closeShop(); };
    inv.appendChild(b);
  });
}

/* ---------- visuals ---------- */
const mainBtn = document.getElementById("mainButton");
const eventText = document.getElementById("eventText");
const fullImg = document.getElementById("fullscreenImage");
const legendaryBanner = document.getElementById("legendaryBanner");

function applySkin(){
  // clear any rgb interval
  if(mainBtn._rgbInterval){ clearInterval(mainBtn._rgbInterval); mainBtn._rgbInterval = null; }
  const s = state.activeSkin;
  mainBtn.style.background = "";
  mainBtn.style.color = (s==="legendary") ? "black" : "white";

  if(s==="red") mainBtn.style.background = "var(--accent)";
  else if(s==="common") mainBtn.style.background = "#6b7280";
  else if(s==="rare") mainBtn.style.background = "#2563eb";
  else if(s==="epic") mainBtn.style.background = "#7c3aed";
  else if(s==="legendary") mainBtn.style.background = "linear-gradient(45deg,#f6d365,#fda085)";
  else if(s==="rgb"){
    // animated RGB
    let hue = 0;
    mainBtn._rgbInterval = setInterval(()=> {
      mainBtn.style.background = `linear-gradient(90deg,hsl(${hue},90%,60%),hsl(${(hue+80)%360},90%,60%))`;
      hue = (hue + 6) % 360;
    },80);
  }
}

/* backgrounds */
function applyBackgroundClass(){
  document.body.classList.remove("bg-default","bg-space");
  if(state.activeBackground === "space") document.body.classList.add("bg-space");
  else document.body.classList.add("bg-default");
  // if legendary active, add gold class on top
  if(state.legendaryActive) document.body.classList.add("goldBG"); else document.body.classList.remove("goldBG");
}

/* ---------- utility ---------- */
function colorForSkin(s){
  if(s==="red") return "red";
  if(s==="common") return "#6b7280";
  if(s==="rare") return "#2563eb";
  if(s==="epic") return "#7c3aed";
  if(s==="legendary") return "gold";
  if(s==="rgb") return "#ff7f50";
  return "#333";
}

/* ---------- rarity roll ---------- */
function rollRarity(){
  const r = Math.random()*100;
  let acc = 0;
  for(const item of RATES){
    acc += item.pct;
    if(r <= acc) return item;
  }
  return RATES[0];
}

/* ---------- main button logic (cooldown 1s) ---------- */
mainBtn.addEventListener("click", async ()=>{
  // if gold active and user clicks main button -> disable gold (as requested)
  if(state.legendaryActive){
    state.legendaryActive = false;
    saveState();
    applyBackgroundClass();
    eventText.innerText = "Z≈Çote t≈Ço wy≈ÇƒÖczone.";
    return;
  }

  if(!state.canClick) return;
  state.canClick = false;

  // click sound
  try{ new Audio(SOUNDS.click).play(); }catch(e){}

  const res = rollRarity();
  state.points += res.pts;
  saveState();
  updateUI();

  // show fullscreen image for 1s
  fullImg.src = PICS[Math.floor(Math.random()*PICS.length)] + "&t=" + Date.now();
  fullImg.style.display = "block";

  // show event text and play sound
  eventText.style.color = (res.id==="legendary") ? "#ffd700" : (res.id==="epic" ? "#b19aff" : (res.id==="rare" ? "#7ec8ff" : "#ddd"));
  if(res.id === "legendary"){
    eventText.innerText = "üíé LEGENDARNY! +" + res.pts;
    // set legendary active (it will remain until next click)
    state.legendaryActive = true;
    saveState();
    applyBackgroundClass();
    // show banner
    legendaryBanner.style.display = "block";
    setTimeout(()=>{ legendaryBanner.style.display = "none"; }, 2300);
    // play sound
    try{ new Audio(res.sound).play(); }catch(e){}
    if(state.musicBought){ try{ const a = new Audio("https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"); a.volume = 0.5; a.play(); }catch(e){} }
  } else {
    eventText.innerText = (res.id === "epic") ? ("EPICKI! +" + res.pts) : ("+" + res.pts);
    if(res.sound) try{ new Audio(res.sound).play(); }catch(e){}
  }

  // hide image after 1s
  setTimeout(()=>{ fullImg.style.display = "none"; }, 1000);

  setTimeout(()=>{ state.canClick = true; }, 1000);
});

/* ---------- shop open/close ---------- */
function openShop(){ document.getElementById("shopOverlay").style.display = "flex"; updateUI(); applyBackgroundClass(); }
function closeShop(){ document.getElementById("shopOverlay").style.display = "none"; applyBackgroundClass(); }

/* ---------- purchases ---------- */
function buySkin(name,cost){
  if(state.points < cost){ alert("Za ma≈Ço punkt√≥w!"); return; }
  state.points -= cost;
  if(!state.ownedSkins.includes(name)) state.ownedSkins.push(name);
  state.activeSkin = name;
  saveState(); applySkin(); updateUI();
  alert("Kupiono skin: " + name.toUpperCase());
}

function buyBackground(name,cost){
  if(state.points < cost){ alert("Za ma≈Ço punkt√≥w!"); return; }
  state.points -= cost;
  if(!state.ownedBackgrounds.includes(name)) state.ownedBackgrounds.push(name);
  state.activeBackground = name;
  saveState(); applyBackgroundClass(); updateUI();
  alert("Kupiono t≈Ço: " + name);
}

function buyMusic(cost){
  if(state.points < cost){ alert("Za ma≈Ço punkt√≥w!"); return; }
  state.points -= cost;
  state.musicBought = true;
  saveState(); updateUI();
  alert("Kupiono muzykƒô legendarnƒÖ.");
}

/* ---------- lucky box: inside shop ---------- */
function buyAndOpenBox(){
  // play small box sound and animate
  if(state.points < 50){ alert("Za ma≈Ço punkt√≥w!"); return; }
  state.points -= 50; saveState(); updateUI();
  try{ new Audio(SOUNDS.box).play(); }catch(e){}

  const lootArea = document.getElementById("lootArea");
  const lootRow = document.getElementById("lootRow");
  lootArea.style.display = "flex";
  lootRow.innerHTML = "";

  // generate sequence
  const seq = [];
  const length = 18;
  for(let i=0;i<length;i++){
    const rr = Math.random()*100;
    let id = "common";
    if(rr < 60) id = "common";
    else if(rr < 85) id = "rare";
    else if(rr < 95) id = "epic";
    else id = "legendary";
    seq.push(id);
  }

  // make cards
  seq.forEach(s=>{
    const d = document.createElement("div");
    d.className = "lootCard " + s;
    d.textContent = s.toUpperCase();
    lootRow.appendChild(d);
  });

  // animate: move so index 8 lands mid
  setTimeout(()=> {
    const itemW = (lootRow.children[0].offsetWidth + 10);
    const offset = itemW * 7; // center on 8th
    lootRow.style.transform = "translateX(-" + offset + "px)";
  },80);

  // after anim finished
  setTimeout(()=>{
    const won = seq[7];
    const rate = RATES.find(r=>r.id === won);
    if(rate){
      state.points += rate.pts;
      if(!state.ownedSkins.includes(won)) state.ownedSkins.push(won);
      state.activeSkin = won;

      // legendary special
      if(won === "legendary"){
        state.legendaryActive = true;
        legendaryBanner.style.display = "block";
        setTimeout(()=>{ legendaryBanner.style.display = "none"; }, 2300);
        if(state.musicBought){ try{ const a = new Audio("https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"); a.volume = 0.5; a.play(); }catch(e){} }
      }
      saveState(); applySkin(); applyBackgroundClass(); updateUI();
      alert("Skrzynka da≈Ça: " + won.toUpperCase() + " (+" + rate.pts + " pkt). Skin ustawiony.");
    }
    lootArea.style.display = "none";
    lootRow.style.transform = "translateX(0)";
  },2600);
}

/* ---------- init ---------- */
applySkin();
applyBackgroundClass();
updateUI();
</script>
</body>
</html>
